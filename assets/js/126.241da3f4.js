(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{517:function(s,a,e){"use strict";e.r(a);var n=e(0),t=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_1-查看磁盘占用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-查看磁盘占用"}},[s._v("#")]),s._v(" 1，查看磁盘占用")]),s._v(" "),a("p",[a("strong",[s._v("docker system df")]),s._v(" 命令，类似于 "),a("strong",[s._v("Linux")]),s._v("上的 "),a("strong",[s._v("df")]),s._v(" 命令，用于查看 "),a("strong",[s._v("Docker")]),s._v(" 的磁盘使用情况：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker system df\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("TYPE")]),s._v("列出了 "),a("strong",[s._v("Docker")]),s._v(" 使用磁盘的 "),a("strong",[s._v("4")]),s._v(" 种类型：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Images")]),s._v(" ：所有镜像占用的空间，包括拉取下来的镜像，和本地构建的。")]),s._v(" "),a("li",[a("strong",[s._v("Containers")]),s._v(" ：运行的容器占用的空间，表示每个容器的读写层的空间。")]),s._v(" "),a("li",[a("strong",[s._v("Local Volumes")]),s._v(" ：容器挂载本地数据卷的空间。")]),s._v(" "),a("li",[a("strong",[s._v("Build Cache")]),s._v(" ：镜像构建过程中产生的缓存空间（只有在使用 "),a("strong",[s._v("BuildKit")]),s._v(" 时才有，"),a("strong",[s._v("Docker 18.09")]),s._v(" 以后可用）。")])]),s._v(" "),a("p",[s._v("最后的 "),a("strong",[s._v("RECLAIMABLE")]),s._v(" 是可回收大小。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("docker system prune")]),s._v(" : 可以用于清理磁盘，删除关闭的容器、无用的数据卷和网络，以及 "),a("strong",[s._v("dangling")]),s._v(" 镜像（即无 "),a("strong",[s._v("tag")]),s._v(" 的镜像）。")]),s._v(" "),a("li",[a("strong",[s._v("docker system prune -a")]),s._v(" : 清理得更加彻底，可以将没有容器使用 "),a("strong",[s._v("Docker")]),s._v("镜像都删掉。\n注意，这两个命令会把你暂时关闭的容器，以及暂时没有用到的 "),a("strong",[s._v("Docker")]),s._v(" 镜像都删掉了。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/3714334f8a08107e.jpg",alt:"eb0053333dd237a83651ec97816cae17"}})]),s._v(" "),a("h2",{attrs:{id:"_2-清理镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-清理镜像"}},[s._v("#")]),s._v(" 2，清理镜像")]),s._v(" "),a("h3",{attrs:{id:"_1-介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-介绍"}},[s._v("#")]),s._v(" 1，介绍")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("docker image prune")]),s._v("可以 删除未使用的映像，注意"),a("a",{attrs:{href:"https://docs.docker.com/engine/api/v1.21/",target:"_blank",rel:"noopener noreferrer"}},[s._v("API 1.21+"),a("OutboundLink")],1),s._v("要使用此命令，客户端和守护进程API都必须至少是 "),a("a",{attrs:{href:"https://docs.docker.com/engine/api/v1.21/",target:"_blank",rel:"noopener noreferrer"}},[s._v("1.21"),a("OutboundLink")],1),s._v(" 。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune -h\nFlag shorthand -h has been deprecated, please use --help\n\nUsage:  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nRemove unused images\n\nOptions:\n  -a, --all             Remove all unused images, not just dangling ones 删除所有未使用的映像，而不仅仅是悬空映像\n      --filter filter   Provide filter values "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e.g. "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'until=<timestamp>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 提供过滤值（例如'until "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("“）\n  -f, --force           Do not prompt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" confirmation 不要提示确认\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"_2-删除所有悬空镜像。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-删除所有悬空镜像。"}},[s._v("#")]),s._v(" 2，删除所有悬空镜像。")]),s._v(" "),a("p",[s._v("删除所有悬空映像。如果"),a("code",[s._v("-a")]),s._v("指定，还将删除任何容器未引用的所有映像。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune -a\nWARNING"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" This will remove all images without at least one container associated to them.\nAre you sure you want to continue? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" y\nDeleted Images:\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_3-过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-过滤"}},[s._v("#")]),s._v(" 3，过滤")]),s._v(" "),a("p",[s._v("过滤标志（"),a("code",[s._v("--filter")]),s._v("）格式为"),a("code",[s._v('"key = value"')]),s._v("。如果有多个过滤器，则传递多个标志（例如"),a("code",[s._v('--filter "foo=bar" --filter "bif=baz"')]),s._v("）")]),s._v(" "),a("p",[s._v("目前支持的过滤器是：")]),s._v(" "),a("ul",[a("li",[s._v("until（"),a("code",[s._v("<timestamp>")]),s._v("） - 仅删除在给定时间戳之前创建的映像")]),s._v(" "),a("li",[s._v("标签（"),a("code",[s._v("label=<key>")]),s._v("，"),a("code",[s._v("label=<key>=<value>")]),s._v("，"),a("code",[s._v("label!=<key>")]),s._v("，或"),a("code",[s._v("label!=<key>=<value>")]),s._v("） -仅删除与映像（或没有，如果"),a("code",[s._v("label!=...")]),s._v("被使用）指定的标签。")])]),s._v(" "),a("p",[s._v("该"),a("code",[s._v("until")]),s._v("过滤器可以是Unix的时间戳，日期格式的时间戳，或持续时间字符串（例如，去"),a("code",[s._v("10m")]),s._v("，"),a("code",[s._v("1h30m")]),s._v("）计算相对于守护机器的时间。支持的格式为日期格式时间戳包括RFC3339Nano，RFC3339， ，"),a("code",[s._v("2006-01-02T15:04:05")]),s._v("，"),a("code",[s._v("2006-01-02T15:04:05.999999999")]),s._v("，"),a("code",[s._v("2006-01-02Z07:00")]),s._v("和"),a("code",[s._v("2006-01-02")]),s._v("。如果在时间戳结束时未提供a "),a("code",[s._v("Z")]),s._v("或 "),a("code",[s._v("+-00:00")]),s._v("时区偏移，则将使用守护程序上的本地时区。提供Unix时间戳时输入秒[.nanoseconds]，其中秒是自1970年1月1日（午夜UTC / GMT）以来经过的秒数，不计算闰秒（也称为Unix纪元或Unix时间）和可选项。纳秒字段是一秒的一小部分，不超过九位数。")]),s._v(" "),a("p",[s._v("的"),a("code",[s._v("label")]),s._v("过滤器接受两种格式。一个是"),a("code",[s._v("label=...")]),s._v("（"),a("code",[s._v("label=<key>")]),s._v("或"),a("code",[s._v("label=<key>=<value>")]),s._v("），它删除具有指定标签的映像。另一种格式是"),a("code",[s._v("label!=...")]),s._v("（"),a("code",[s._v("label!=<key>")]),s._v("或"),a("code",[s._v("label!=<key>=<value>")]),s._v("），它删除没有指定标签的映像。")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("预测将被删除的内容")])]),s._v(" "),a("p",[s._v("如果使用正过滤（测试标签是否存在或标签是否具有特定值），则可以使用"),a("code",[s._v("docker image ls")]),s._v("相同的过滤语法查看哪些映像与过滤器匹配。")]),s._v(" "),a("p",[s._v("但是，如果使用的是负过滤（测试对于不存在标签的或标签并"),a("em",[s._v("不")]),s._v("具有特定的值），这种类型的滤波器的不与工作"),a("code",[s._v("docker image ls")]),s._v("所以不能容易地预测哪些映像将被移除。此外，即使您正在使用，确认提示"),a("code",[s._v("docker image prune")]),s._v(" 始终会警告"),a("em",[s._v("所有")]),s._v("悬空映像将被删除 "),a("code",[s._v("--filter")]),s._v("。")])]),s._v(" "),a("p",[s._v("以下删除之前创建的映像"),a("code",[s._v("2021-01-01T00:00:00")]),s._v("。")]),s._v(" "),a("p",[s._v("查看：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images --format "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table {{.Repository}}\\t{{.Tag}}\\t{{.ID}}\\t{{.CreatedAt}}\\t{{.Size}}'")]),s._v("\nREPOSITORY                                        TAG       IMAGE ID       CREATED AT                      SIZE\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("                                              latest    65f677cc947a   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-08-19 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":38:05 +0800 CST   445MB\nregistry.cn-hangzhou.aliyuncs.com/eryajf/centos   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.8")]),s._v("       5ea7c3a67505   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-11-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":32:46 +0800 CST   475MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("执行删除：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune -a --force --filter "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"until=2021-01-01T00:00:00"')]),s._v("\nDeleted Images:\nuntagged: registry.cn-hangzhou.aliyuncs.com/eryajf/centos:7.8\nuntagged: registry.cn-hangzhou.aliyuncs.com/eryajf/centos@sha256:f7c413edcad7a3389e079cf04b4cddb46c96d67d29bf8c0d48dbd1ceeee2b474\ndeleted: sha256:5ea7c3a675055762552ad50b6f293bb050bdee188da3a2c37c61be90450f5987\ndeleted: sha256:c8279b704e4fb851f28a3fe2f02365df13bed3b6cc9b1fae6b2c50d562b04cec\ndeleted: sha256:e5a0eda56319769809257786837e4478e778aba54cdac72a468a8ac053637ca4\ndeleted: sha256:da34d2fe9e29af7b5ad6447089b19c2d0c7aa11d79641ca25e3de88a851706c7\ndeleted: sha256:613be09ab3c0860a5216936f412f09927947012f86bfa89b263dfa087a725f81\n\nTotal reclaimed space: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("475")]),s._v(".2MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("可以看到在这个时间点之前的centos镜像被删除了。如果这个镜像在占用状态，则不会删除。查看验证：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images --format "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table {{.Repository}}\\t{{.Tag}}\\t{{.ID}}\\t{{.CreatedAt}}\\t{{.Size}}'")]),s._v("\nREPOSITORY   TAG       IMAGE ID       CREATED AT                      SIZE\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("         latest    65f677cc947a   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-08-19 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":38:05 +0800 CST   445MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[a("code",[s._v("其他一些用法")])]),s._v("：")]),s._v(" "),a("blockquote",[a("ul",[a("li",[a("p",[s._v("删除超过10天"),a("code",[s._v("240h")]),s._v("前创建的映像：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune -a --force --filter "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"until=240h"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("使用标签删除映像"),a("code",[s._v("deprecated")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune --filter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label=deprecated"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("删除标签"),a("code",[s._v("maintainer")]),s._v("设置为的映像"),a("code",[s._v("john")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune --filter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label=maintainer=john"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("删除没有"),a("code",[s._v("maintainer")]),s._v("标签的映像：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune --filter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label!=maintainer"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("删除维护者标签未设置为的映像"),a("code",[s._v("john")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune --filter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label!=maintainer=john"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])]),s._v(" "),a("p",[a("strong",[s._v("注意")]),s._v("：在"),a("code",[s._v("prune")]),s._v("删除任何内容之前，系统会提示您进行确认，但不会显示可能删除的内容列表。此外，"),a("code",[s._v("docker image ls")]),s._v("不支持负过滤，因此很难预测实际将删除哪些映像。")]),s._v(" "),a("h2",{attrs:{id:"_3-定义容器日志大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-定义容器日志大小"}},[s._v("#")]),s._v(" 3，定义容器日志大小")]),s._v(" "),a("p",[s._v("在docker环境部署之后，我们可以直接通过配置文件参数来定义单个容器日志的大小，在/etc/docker/daemon.json添加如下配置后重启docker：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"log-opts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"max-size"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"300M"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"max-file"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"data-root"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/docker/docker-data/"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("注意：已存在的容器需要删除重建后才可以生效，因此尽量在docker投入生产之前进行配置。")])]),s._v(" "),a("blockquote",[a("p",[s._v("参数说明：max-size指定日志文件最大空间，max-file指定日志滚动的次数，以上配置单个容器最大日志为900M。data-root指定docker数据目录。")])])])}),[],!1,null,null,null);a.default=t.exports}}]);